(function(b,a){typeof define=='function'&&define.amd?define([],a):typeof module=='object'&&module.exports?module.exports=a():b.fuzzysort=a()})(this,function(){var f,h,g,e,a,d,j,b;function l(o){var n={single:function(a,b,d){var e,f;return a?(c(a)||(a=n.getPreparedSearch(a)),!b)?null:(c(b)||(b=n.getPrepared(b)),e=d&&d.allowTypo!==void 0?d.allowTypo:!(o&&o.allowTypo!==void 0)||o.allowTypo,f=e?n.algorithm:n.algorithmNoTypo,f(a,b,a[0])):null},go:function(l,y,g){var x,w,v,C,u,h,q,t,D,B,A,f,m,j,p,z,a,r,d,s;if(!l)return e;if(l=n.prepareSearch(l),x=l[0],w=g&&g.threshold||o&&o.threshold||-9007199254740991,v=g&&g.limit||o&&o.limit||9007199254740991,C=g&&g.allowTypo!==void 0?g.allowTypo:!(o&&o.allowTypo!==void 0)||o.allowTypo,u=C?n.algorithm:n.algorithmNoTypo,h=0,q=0,t=y.length,g&&g.keys){{D=g.scoreFn||k,B=g.keys,A=B.length;for(f=t-1;f>=0;--f){m=y[f],j=new Array(A);for(p=A-1;p>=0;--p){if(z=B[p],a=i(m,z),!a){j[p]=null;continue}c(a)||(a=n.getPrepared(a)),j[p]=u(l,a,x)}if(j.obj=m,r=D(j),r===null)continue;if(r<w)continue;j.score=r,h<v?(b.add(j),++h):(++q,r>b.peek().score&&b.replaceTop(j))}}}else if(g&&g.key){{z=g.key;for(f=t-1;f>=0;--f){if(m=y[f],a=i(m,z),!a)continue;if(c(a)||(a=n.getPrepared(a)),d=u(l,a,x),d===null)continue;if(d.score<w)continue;d={target:d.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:d.score,indexes:d.indexes,obj:m},h<v?(b.add(d),++h):(++q,d.score>b.peek().score&&b.replaceTop(d))}}}else for(f=t-1;f>=0;--f){if(a=y[f],!a)continue;if(c(a)||(a=n.getPrepared(a)),d=u(l,a,x),d===null)continue;if(d.score<w)continue;h<v?(b.add(d),++h):(++q,d.score>b.peek().score&&b.replaceTop(d))}if(h===0)return e;s=new Array(h);for(f=h-1;f>=0;--f)s[f]=b.poll();return s.total=h+q,s},goAsync:function(b,d,a){var g=!1,h=new Promise(function(v,x){var s,l,h,u,r,w,t,m,q;if(!b)return v(e);b=n.prepareSearch(b),s=b[0],l=j(),h=d.length-1,u=a&&a.threshold||o&&o.threshold||-9007199254740991,r=a&&a.limit||o&&o.limit||9007199254740991,w=a&&a.allowTypo!==void 0?a.allowTypo:!(o&&o.allowTypo!==void 0)||o.allowTypo,t=w?n.algorithm:n.algorithmNoTypo,m=0,q=0;function p(){var B,H,G,F,z,w,y,C,j,A,o,D,E;if(g)return x('canceled');if(B=Date.now(),a&&a.keys){for(H=a.scoreFn||k,G=a.keys,F=G.length;h>=0;--h){z=d[h],w=new Array(F);for(y=F-1;y>=0;--y){if(C=G[y],j=i(z,C),!j){w[y]=null;continue}c(j)||(j=n.getPrepared(j)),w[y]=t(b,j,s)}if(w.obj=z,A=H(w),A===null)continue;if(A<u)continue;if(w.score=A,m<r?(l.add(w),++m):(++q,A>l.peek().score&&l.replaceTop(w)),h%1e3===0)if(Date.now()-B>=10){f?setImmediate(p):setTimeout(p);return}}}else if(a&&a.key){for(C=a.key;h>=0;--h){if(z=d[h],j=i(z,C),!j)continue;if(c(j)||(j=n.getPrepared(j)),o=t(b,j,s),o===null)continue;if(o.score<u)continue;if(o={target:o.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:o.score,indexes:o.indexes,obj:z},m<r?(l.add(o),++m):(++q,o.score>l.peek().score&&l.replaceTop(o)),h%1e3===0)if(Date.now()-B>=10){f?setImmediate(p):setTimeout(p);return}}}else for(;h>=0;--h){if(j=d[h],!j)continue;if(c(j)||(j=n.getPrepared(j)),o=t(b,j,s),o===null)continue;if(o.score<u)continue;if(m<r?(l.add(o),++m):(++q,o.score>l.peek().score&&l.replaceTop(o)),h%1e3===0)if(Date.now()-B>=10){f?setImmediate(p):setTimeout(p);return}}if(m===0)return v(e);D=new Array(m);for(E=m-1;E>=0;--E)D[E]=l.poll();D.total=m+q,v(D)}f?setImmediate(p):p()});return h.cancel=function(){g=!0},h},highlight:function(h,g,e){var a,f,c,d,k,i,b,j;if(h===null)return null;g===void 0&&(g='<b>'),e===void 0&&(e='</b>'),a='',f=0,c=!1,d=h.target,k=d.length,i=h.indexes;for(b=0;b<k;++b){if(j=d[b],i[f]===b){if(++f,c||(c=!0,a+=g),f===i.length){a+=j+e+d.substr(b+1);break}}else c&&(c=!1,a+=e);a+=j}return a},prepare:function(a){if(!a)return;return{target:a,_targetLowerCodes:n.prepareLowerCodes(a),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(a){if(!a)return;return{target:a,_targetLowerCodes:n.prepareLowerCodes(a),_nextBeginningIndexes:n.prepareNextBeginningIndexes(a),score:null,indexes:null,obj:null}},prepareSearch:function(a){if(!a)return;return n.prepareLowerCodes(a)},getPrepared:function(a){if(a.length>999)return n.prepare(a);var b=h.get(a);return b!==void 0?b:(b=n.prepare(a),h.set(a,b),b)},getPreparedSearch:function(a){if(a.length>999)return n.prepareSearch(a);var b=g.get(a);return b!==void 0?b:(b=n.prepareSearch(a),g.set(a,b),b)},algorithm:function(h,f,k){for(var s=f._targetLowerCodes,l=h.length,p=s.length,b=0,c=0,e=0,o=0,w,t,g,q,r,m,z,y,u,v,j,x,i;;){if(w=k===s[c],w){if(a[o++]=c,++b,b===l)break;k=h[e===0?b:e===b?b+1:e===b-1?b-1:b]}if(++c,c>=p)for(;;){if(b<=1)return null;if(e===0){if(--b,t=h[b],k===t)continue;e=b}else{if(e===1)return null;if(--e,b=e,k=h[b+1],t=h[b],k===t)continue}o=b,c=a[o-1]+1;break}}if(b=0,g=0,q=!1,r=0,m=f._nextBeginningIndexes,m===null&&(m=f._nextBeginningIndexes=n.prepareNextBeginningIndexes(f.target)),z=c=a[0]===0?0:m[a[0]-1],c!==p)for(;;)if(c>=p){if(b<=0){if(++g,g>l-2)break;if(h[g]===h[g+1])continue;c=z;continue}--b,y=d[--r],c=m[y]}else if(w=h[g===0?b:g===b?b+1:g===b-1?b-1:b]===s[c],w){if(d[r++]=c,++b,b===l){q=!0;break}++c}else c=m[c];{q?(u=d,v=r):(u=a,v=o),j=0,x=-1;for(i=0;i<l;++i)c=u[i],x!==c-1&&(j-=c),x=c;q?g!==0&&(j+=-20):(j*=1e3,e!==0&&(j+=-20)),j-=p-l,f.score=j,f.indexes=new Array(v);for(i=v-1;i>=0;--i)f.indexes[i]=u[i];return f}},algorithmNoTypo:function(r,e,t){for(var k=e._targetLowerCodes,i=r.length,h=k.length,c=0,b=0,s=0,m,q,o,g,w,v,p,l,j,u,f;;){if(m=t===k[b],m){if(a[s++]=b,++c,c===i)break;t=r[c]}if(++b,b>=h)return null}if(c=0,q=!1,o=0,g=e._nextBeginningIndexes,g===null&&(g=e._nextBeginningIndexes=n.prepareNextBeginningIndexes(e.target)),w=b=a[0]===0?0:g[a[0]-1],b!==h)for(;;)if(b>=h){if(c<=0)break;--c,v=d[--o],b=g[v]}else if(m=r[c]===k[b],m){if(d[o++]=b,++c,c===i){q=!0;break}++b}else b=g[b];{q?(p=d,l=o):(p=a,l=s),j=0,u=-1;for(f=0;f<i;++f)b=p[f],u!==b-1&&(j-=b),u=b;q||(j*=1e3),j-=h-i,e.score=j,e.indexes=new Array(l);for(f=l-1;f>=0;--f)e.indexes[f]=p[f];return e}},prepareLowerCodes:function(b){for(var d=b.length,c=[],e=b.toLowerCase(),a=0;a<d;++a)c[a]=e.charCodeAt(a);return c},prepareBeginningIndexes:function(g){for(var i=g.length,h=[],j=0,e=!1,f=!1,b=0,a,c,d,k;b<i;++b)a=g.charCodeAt(b),c=a>=65&&a<=90,d=c||a>=97&&a<=122||a>=48&&a<=57,k=c&&!e||!f||!d,e=c,f=d,k&&(h[j++]=b);return h},prepareNextBeginningIndexes:function(f){for(var d=f.length,e=n.prepareBeginningIndexes(f),c=[],b=e[0],g=0,a=0;a<d;++a)b>a?c[a]=b:(b=e[++g],c[a]=b===void 0?d:b);return c},cleanup:m,new:l};return n}f=typeof require!='undefined'&&typeof window=='undefined',h=new Map,g=new Map,e=[],e.total=0,a=[],d=[];function m(){h.clear(),g.clear(),a=[],d=[]}function k(c){for(var a=-9007199254740991,b=c.length-1,d,e;b>=0;--b){if(d=c[b],d===null)continue;e=d.score,e>a&&(a=e)}return a===-9007199254740991?null:a}function i(a,b){var d=a[b],c,f,e;if(d!==void 0)return d;for(c=b,Array.isArray(b)||(c=b.split('.')),f=c.length,e=-1;a&&++e<f;)a=a[c[e]];return a}function c(a){return typeof a=='object'}return j=function(){var a=[],b=0,c={};function d(){for(var c=0,g=a[c],d=1,f,e;d<b;)f=d+1,c=d,f<b&&a[f].score<a[d].score&&(c=f),a[c-1>>1]=a[c],d=1+(c<<1);for(e=c-1>>1;c>0&&g.score<a[e].score;e=(c=e)-1>>1)a[c]=a[e];a[c]=g}return c.add=function(e){var c=b,d;a[b++]=e;for(d=c-1>>1;c>0&&e.score<a[d].score;d=(c=d)-1>>1)a[c]=a[d];a[c]=e},c.poll=function(){if(0!==b){var c=a[0];return a[0]=a[--b],d(),c}},c.peek=function(c){if(0!==b)return a[0]},c.replaceTop=function(b){a[0]=b,d()},c},b=j(),l()})